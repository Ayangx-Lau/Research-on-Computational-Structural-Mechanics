! 定义常量和参数
*dim, coords, array, 3
coords(1) = 0   ! 三角形顶点1的x坐标
coords(2) = 5   ! 三角形顶点1的y坐标
coords(3) = 40  ! 三角形顶点2的x坐标
coords(4) = 45  ! 三角形顶点2的y坐标
coords(5) = 0   ! 三角形顶点3的x坐标
coords(6) = 45  ! 三角形顶点3的y坐标

! 创建几何模型
! 创建边长为50的正方形
K, 1, 0, 0      ! 创建节点1
K, 2, 50, 0     ! 创建节点2
K, 3, 50, 50    ! 创建节点3
K, 4, 0, 50     ! 创建节点4
L, 1, 2          ! 连接节点1和节点2
L, 2, 3          ! 连接节点2和节点3
L, 3, 4          ! 连接节点3和节点4
L, 4, 1          ! 连接节点4和节点1

! 减去左上三角形区域
K, 5, 0, 45     ! 创建三角形顶点
K, 6, 40, 45
K, 7, 0, 5
L, 5, 6          ! 连接三角形边1
L, 6, 7          ! 连接三角形边2
L, 7, 5          ! 连接三角形边3

! 对称操作减去右下三角形
! 定义对称线 y=x
*get, max_k, node, 0, num, max
! 对称生成三角形
/geo, reflect, 1, 0, 0, 1  ! 对称操作

! 设置基体材料弹性模量和泊松比
MP, EX, 1, 2E8      ! 弹性模量
MP, PRXY, 1, 0.3    ! 泊松比

! 定义塑性行为和强化准则（多线性等向强化模型）
TB, PLASTIC, 1, 3, 1   ! 塑性材料模型
TBDATA, 1, 4E5, 0.01  ! 初始应力-应变数据
TBDATA, 2, 5E5, 0.01  ! 塑性应变为0.01时的应力
TBDATA, 3, 2.05E7, 10.01  ! 塑性应变为10.01时的应力

! 网格划分设置
ET, 1, PLANE183       ! 单元类型为PLANE183
KEYOPT, 1, 3, 2      ! 平面应变
ESYS, 0              ! 全局坐标系

! 智能化网格划分方法，等级为2
LESIZE, 1, 2, 2      ! 网格大小设置
LMESH, 1             ! 网格生成

! 镜像操作构建100*100的点阵结构模型
*do, i, 1, 2
  *do, j, 1, 2
    /repeat, i, j  ! 镜像操作
  *enddo
*enddo

! 合并和压缩网格实体编号
*dim, merge, array, 100
*dim, compress, array, 100

! 进入求解模块，设置静力分析
SOLVE, static

! 位移边界条件
! 固定上下侧节点的y方向
D, 1, ALL, 0      ! 固定节点1的y方向
D, 50, ALL, 0     ! 固定节点50的y方向

! 拉伸边界条件
! 左右侧节点x方向位移增量0.01，施加总位移为1，总计100个时间步
*do, step, 1, 100
  D, 1, UX, 0.01*step   ! 施加位移
  D, 50, UX, 0.01*step  ! 施加位移
  SOLVE
*enddo

! 完成求解
FINISH
