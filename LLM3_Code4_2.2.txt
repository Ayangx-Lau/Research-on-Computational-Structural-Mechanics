/prep7
! 设置单位和定义参数
et,1,plane183       ! 定义单元类型为PLANE183
keyopt,1,3,0       ! 设置为平面应变
mp,ex,1,2e8        ! 定义基体材料弹性模量
mp,nuxy,1,0.3      ! 定义泊松比

! 创建初始正方形
blc4,0,0,50,50     ! 在左下角(0,0)创建边长为50的正方形

! 减去左上三角形
k,1,0,5            ! 三角形第一个顶点
k,2,0,45           ! 三角形第二个顶点
k,3,40,45          ! 三角形第三个顶点
a,1,2,3            ! 创建三角形面
asel,s,area,,1     ! 选择该三角形面
esla,s             ! 选择与面相关的边
adele,all          ! 删除选中的三角形面

! 减去右下三角形（通过y=x对称）
k,4,45,5           ! 对称后的第一个顶点
k,5,45,45          ! 对称后的第二个顶点
k,6,5,0            ! 对称后的第三个顶点
a,4,5,6            ! 创建对称三角形面
asel,s,area,,2     ! 选择该三角形面
esla,s             ! 选择与面相关的边
adele,all          ! 删除选中的三角形面

! 定义材料塑性行为
tb,plast,1         ! 打开塑性行为定义
tbdata,1,4e5,0     ! 初始塑性应变对应的应力
tbdata,2,5e5,0.01  ! 塑性应变为0.01时对应的应力
tbdata,3,20.5e6,10.01 ! 塑性应变为10.01时对应的应力

! 网格划分
esla,all           ! 选择所有实体
vmesh,all          ! 智能化网格划分，默认2级

! 镜像操作 - 首先在y方向镜像
nsel,s,loc,y,0     ! 选择y=0上所有节点
d,all,uy,0         ! 固定这些节点在y方向的位移
nsel,all           ! 选择所有节点
amsel,s            ! 镜像关于y轴
esym,all           ! 镜像网格

! 镜像操作 - 然后在x方向镜像
nsel,s,loc,x,50    ! 选择x=50上所有节点（原始右边界）
d,all,ux,0.01      ! 施加位移增量初始值
nsel,all           ! 选择所有节点
amsel,s            ! 镜像关于x轴
esym,all           ! 镜像网格

! 合并和压缩实体编号
numcmp,all         ! 合并节点编号
esel,all           ! 选择所有单元
ecomp,all          ! 压缩单元编号

! 进入求解器模块
/solu
solve

! 静力分析设置
antype,static      ! 分析类型为静力分析

! 位移边界条件
nsel,s,loc,y,-25   ! 选择下边界所有节点（y=-25）
d,all,uy,0         ! 固定下边界y方向位移
nsel,s,loc,y,25    ! 选择上边界所有节点（y=25）
d,all,uy,0         ! 固定上边界y方向位移

! 施加x方向拉伸载荷
nsel,s,loc,x,-50   ! 选择左边界所有节点
d,all,ux,0         ! 左边界x位移初始为0
nsel,s,loc,x,50    ! 选择右边界所有节点
*do,i,1,100        ! 循环100次施加载荷
    f,all,fx,1000  ! 每个时间步施加恒定拉力（可以调整）
    esel,all       ! 选择所有单元
    solve          ! 求解
    /post1         ! 进入后处理模块查看结果（如需要）
    set,last       ! 查看最后一步结果
    plnsol,u,sum   ! 显示变形图
    /solu          ! 返回求解器模块
    d,all,ux,0.01*(i) ! 增加右边界位移
*enddo

finish
/exit,all