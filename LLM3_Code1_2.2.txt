/prep7
! 设置单位和定义参数
et,1,plane183       ! 定义单元类型为PLANE183（平面应变）
mp,ex,1,2e8         ! 定义基体材料的弹性模量为2e8
mp,nuxy,1,0.3       ! 定义泊松比为0.3

! 创建初始正方形区域
blc4,0,0,50,50      ! 在左下角(0,0)创建边长为50的正方形

! 减去左上角三角形区域
k,1,0,5             ! 三角形第一个顶点
k,2,0,45            ! 三角形第二个顶点
k,3,40,45           ! 三角形第三个顶点
a,1,2,3             ! 创建三角形面
esel,s,type,,4      ! 选择所有面
aslv,s              ! 选择面上的节点
nslv,s              ! 将面上的节点选中
edele,all           ! 删除选中节点，完成减操作

! 减去右下角三角形区域（通过y=x对称）
ksel,s,kp,,1        ! 选择第一个关键点
kmodif,1,0,0,45     ! 对称变换
ksel,s,kp,,2        ! 选择第二个关键点
kmodif,2,0,0,5      ! 对称变换
ksel,s,kp,,3        ! 选择第三个关键点
kmodif,3,40,45,0    ! 对称变换
k,4,50,5            ! 添加新关键点用于闭合区域
a,1,2,3,4           ! 创建右下角对称的三角形面
esel,s,type,,4      ! 选择所有面
aslv,s              ! 选择面上的节点
nslv,s              ! 将面上的节点选中
edele,all           ! 删除选中节点，完成减操作

! 定义材料塑性行为
tb,plast,1,1        ! 激活塑性行为，材料号1，第一个数据表
tbdata,1,4e5,0      ! 初始塑性应变对应的应力
tbdata,2,5e5,0.01   ! 塑性应变为0.01时对应的应力
tbdata,3,20.5e6,10.01 ! 塑性应变为10.01时对应的应力

! 网格划分
esel,all            ! 选择所有实体
vmesh,all           ! 划分网格，采用默认智能化方法，等级2

! 镜像操作 - x方向
nsel,s,loc,x,0      ! 选择y轴左侧所有节点
esym,x,all          ! 关于x轴镜像

! 镜像操作 - y方向
nsel,s,loc,y,0      ! 选择x轴下方所有节点
esym,y,all          ! 关于y轴镜像

! 合并和压缩实体编号
nummrg,node         ! 合并重复节点
numcmp,all          ! 压缩实体编号

! 进入求解器模块
/solu
antype,0            ! 静力分析

! 施加位移边界条件
nsel,s,loc,y,25     ! 选择上边界所有节点 (y=25到y=75，但由于对称性，只需设置一半)
d,all,uy,0          ! 固定上边界y方向位移
nsel,s,loc,y,-25    ! 选择下边界所有节点
d,all,uy,0          ! 固定下边界y方向位移

! 施加位移载荷 - 左侧和右侧
nsel,s,loc,x,-50    ! 选择左侧边界所有节点
d,all,ux,0          ! 初始左侧位移为0
nsel,s,loc,x,50     ! 选择右侧边界所有节点

! 循环施加位移增量
*do,i,1,100,1
    nsel,s,loc,x,50    ! 选择右侧所有节点
    esel,s,type,,2     ! 确保选择相关单元
    d,all,ux,0.01*i    ! 每次增加0.01的位移
    solve              ! 求解
*enddo

! 结束求解
finish
/exit,all