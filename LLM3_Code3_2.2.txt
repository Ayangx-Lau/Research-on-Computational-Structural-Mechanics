/prep7
! 设置单位和定义参数
et,1,plane183       ! 定义单元类型为PLANE183（平面应变）
mp,ex,1,2e8         ! 定义基体材料弹性模量为2e8
mp,nuxy,1,0.3       ! 定义泊松比为0.3

! 创建初始正方形区域
blc4,0,0,50,50      ! 在(0,0)生成一个50x50的正方形

! 减去左上三角形区域
k,1,0,5             ! 定义关键点1 (0,5)
k,2,0,45            ! 定义关键点2 (0,45)
k,3,40,45           ! 定义关键点3 (40,45)
a,1,2,3             ! 通过关键点1,2,3生成三角形区域
asel,s,area,,,1     ! 选择生成的三角形区域
esla,s              ! 选择与区域相关的单元
edele,all           ! 删除选中的单元

! 减去右下三角形区域（以y=x为对称线）
ksel,s              ! 选择关键点集合
kmodif,1,0,0,45     ! 修改关键点1的坐标 -> (0,45)【对称】
kmodif,2,50,0,0     ! 修改关键点2的坐标 -> (50,0)【对称】
kmodif,3,50,50,0    ! 修改关键点3的坐标 -> (50,50)【对称】
a,1,2,3             ! 通过新的关键点1,2,3生成右下三角形区域
asel,s,area,,,2     ! 选择生成的三角形区域
esla,s              ! 选择与区域相关的单元
edele,all           ! 删除选中的单元

! 定义材料塑性行为
tb,plast,1,1        ! 激活塑性行为，材料号1，第一个数据表
tbdata,1,4e5,0      ! 初始屈服应力4e5，初始塑性应变0
tbdata,2,5e5,0.01   ! 塑性应变0.01时，应力5e5
tbdata,3,20.5e6,10.01 ! 塑性应变10.01时，应力20.5e6

! 网格划分
esel,all            ! 选择所有单元
vmesh,all           ! 使用智能化网格划分，默认2级

! 镜像操作 - 首先在y方向镜像
nsel,s,loc,y,0      ! 选择y=0线上所有节点
nmirror,0,0,1,0     ! 关于x轴（y=0）镜像

! 镜像操作 - 然后在x方向镜像
nsel,s,loc,x,50     ! 选择x=50线上所有节点
nmirror,1,0,0,0     ! 关于y轴（x=50）镜像

! 合并和压缩节点编号
nummrg,node         ! 合并重复节点
numcmp,node         ! 压缩节点编号

! 进入求解器模块
/solu
antype,0            ! 静力分析

! 施加位移边界条件
nsel,s,loc,y,25     ! 选择上边界y=25的所有节点
d,all,uy,0          ! 固定上边界节点在y方向的位移
nsel,s,loc,y,-25    ! 选择下边界y=-25的所有节点
d,all,uy,0          ! 固定下边界节点在y方向的位移

! 施加位移载荷（循环加载）
nsel,s,loc,x,-50    ! 选择左边界x=-50的所有节点
d,all,ux,0          ! 初始位移为0
nsel,s,loc,x,50     ! 选择右边界x=50的所有节点

*do,i,1,100         ! 循环100次，每次位移增量0.01
    d,all,ux,0.01*i ! 施加向右位移
    solve           ! 求解
*enddo

! 结束求解
finish
/exit,all